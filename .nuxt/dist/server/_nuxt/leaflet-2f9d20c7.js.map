{"version":3,"file":"leaflet-2f9d20c7.js","sources":["../../../../pages/leaflet.vue"],"sourcesContent":["<template>\r\n  <div ref=\"MapRef\" class=\"map-container\"></div>\r\n</template>\r\n<script setup>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nconst StateDestinations = useState(\"Destinations\");\r\n\r\nconst MapRef = ref(null);\r\nconst districtMarkers = ref([]);\r\nconst detailedMarkers = ref({});\r\nconst Destinations = ref([]);\r\nconst CookieFilters = useCookie(\"Filters\");\r\n\r\nonMounted(async () => {\r\n  await FilterDestinationData();\r\n  await AddMarker();\r\n});\r\n\r\nconst AddMarker = async () => {\r\n  const L = await import(\"leaflet\");\r\n  MapRef.value = L.map(MapRef.value).setView([36.8969, 30.7133], 9);\r\n  L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n    attribution:\r\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n  }).addTo(MapRef.value);\r\n\r\n  // Initial markers\r\n  updateMarkers();\r\n\r\n  MapRef.value.on(\"zoomend\", () => {\r\n    const zoomLevel = MapRef.value.getZoom();\r\n    if (zoomLevel < 12) {\r\n      clearDetailedMarkers();\r\n      showDistrictMarkers();\r\n    } else {\r\n      const currentBounds = MapRef.value.getBounds();\r\n      Destinations.value.forEach((destination) => {\r\n        const latitude = parseFloat(destination.address.latitude);\r\n        const longitude = parseFloat(destination.address.longitude);\r\n        if (\r\n          latitude &&\r\n          longitude &&\r\n          currentBounds.contains([latitude, longitude])\r\n        ) {\r\n          showDetailedMarkers(destination.address.subCity);\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nwatch(() => Destinations.value, updateMarkers, { deep: true });\r\n\r\nfunction updateMarkers() {\r\n  const L = window.L;\r\n  const groupedBySubCity = Destinations.value.reduce((acc, destination) => {\r\n    const subCity = destination.address.subCity;\r\n    if (!acc[subCity]) acc[subCity] = [];\r\n    acc[subCity].push(destination);\r\n    return acc;\r\n  }, {});\r\n\r\n  Object.keys(groupedBySubCity).forEach((subCity) => {\r\n    const destinationsInSubCity = groupedBySubCity[subCity];\r\n    const firstDestination = destinationsInSubCity[0];\r\n    const latitude = parseFloat(firstDestination.address.latitude);\r\n    const longitude = parseFloat(firstDestination.address.longitude);\r\n\r\n    if (latitude && longitude) {\r\n      const marker = L.marker([latitude, longitude], {\r\n        icon: L.divIcon({\r\n          className: \"city-marker\",\r\n          html: `${destinationsInSubCity.length}`,\r\n        }),\r\n      })\r\n        .addTo(MapRef.value)\r\n        .bindPopup(`${subCity}: ${destinationsInSubCity.length} yer`)\r\n        .on(\"click\", () => {\r\n          MapRef.value.setView([latitude, longitude], 12);\r\n          showDetailedMarkers(subCity);\r\n        });\r\n\r\n      districtMarkers.value.push(marker);\r\n      detailedMarkers.value[subCity] = [];\r\n    }\r\n  });\r\n}\r\n\r\nfunction showDetailedMarkers(subCity) {\r\n  hideDistrictMarkers();\r\n  const destinationsInSubCity = Destinations.value.filter(\r\n    (destination) => destination.address.subCity === subCity\r\n  );\r\n\r\n  const L = window.L;\r\n  destinationsInSubCity.forEach((destination) => {\r\n    const latitude = parseFloat(destination.address.latitude);\r\n    const longitude = parseFloat(destination.address.longitude);\r\n\r\n    if (latitude && longitude) {\r\n      const marker = L.marker([latitude, longitude])\r\n        .addTo(MapRef.value)\r\n        .bindPopup(\r\n          `<b>${destination.name}</b><br>${destination.address.detail}`\r\n        );\r\n\r\n      detailedMarkers.value[subCity].push(marker);\r\n    }\r\n  });\r\n}\r\n\r\nfunction hideDistrictMarkers() {\r\n  districtMarkers.value.forEach((marker) => MapRef.value.removeLayer(marker));\r\n}\r\n\r\nfunction showDistrictMarkers() {\r\n  districtMarkers.value.forEach((marker) => marker.addTo(MapRef.value));\r\n}\r\n\r\nfunction clearDetailedMarkers() {\r\n  for (const district in detailedMarkers.value) {\r\n    detailedMarkers.value[district].forEach((marker) =>\r\n      MapRef.value.removeLayer(marker)\r\n    );\r\n    detailedMarkers.value[district] = [];\r\n  }\r\n}\r\n\r\nfunction clearDistrictMarkers() {\r\n  districtMarkers.value.forEach((marker) => MapRef.value.removeLayer(marker));\r\n  districtMarkers.value = [];\r\n}\r\n\r\nconst FilterDestinationData = async () => {\r\n  const FilteredData = await DestinationComposable().GetFilteredDestinations(\r\n    CookieFilters.value\r\n  );\r\n  StateDestinations.value = Destinations.value = FilteredData.data.content;\r\n};\r\n</script>\r\n\r\n<style>\r\n.map-container {\r\n  width: 100%;\r\n  height: 100vh;\r\n  border-radius: 8px;\r\n}\r\n\r\n.city-marker {\r\n  background-color: rgba(255, 255, 255, 0.8);\r\n  border: 2px solid #000;\r\n  border-radius: 50%;\r\n  text-align: center;\r\n  line-height: 40px;\r\n  height: 70px;\r\n  width: 70px;\r\n  font-size: 14px;\r\n  font-weight: bold;\r\n  color: #000;\r\n}\r\n\r\n.leaflet-popup-content {\r\n  width: 230px;\r\n}\r\n\r\n.map-popup {\r\n  width: 230px;\r\n}\r\n\r\n.map-popup .map-thumb {\r\n  width: 100%;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 8px;\r\n}\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM0B,aAAS,cAAc;AAEjD,UAAM,SAAS,IAAI,IAAI;AACvB,UAAM,kBAAkB,IAAI,CAAA,CAAE;AAC9B,UAAM,kBAAkB,IAAI,CAAA,CAAE;AAC9B,UAAM,eAAe,IAAI,CAAA,CAAE;AACL,cAAU,SAAS;AAwCzC,UAAM,MAAM,aAAa,OAAO,eAAe,EAAE,MAAM,KAAI,CAAE;AAE7D,aAAS,gBAAgB;AACvB,YAAM,IAAI,OAAO;AACjB,YAAM,mBAAmB,aAAa,MAAM,OAAO,CAAC,KAAK,gBAAgB;AACvE,cAAM,UAAU,YAAY,QAAQ;AACpC,YAAI,CAAC,IAAI,OAAO;AAAG,cAAI,OAAO,IAAI;AAClC,YAAI,OAAO,EAAE,KAAK,WAAW;AAC7B,eAAO;AAAA,MACR,GAAE,CAAE,CAAA;AAEL,aAAO,KAAK,gBAAgB,EAAE,QAAQ,CAAC,YAAY;AACjD,cAAM,wBAAwB,iBAAiB,OAAO;AACtD,cAAM,mBAAmB,sBAAsB,CAAC;AAChD,cAAM,WAAW,WAAW,iBAAiB,QAAQ,QAAQ;AAC7D,cAAM,YAAY,WAAW,iBAAiB,QAAQ,SAAS;AAE/D,YAAI,YAAY,WAAW;AACzB,gBAAM,SAAS,EAAE,OAAO,CAAC,UAAU,SAAS,GAAG;AAAA,YAC7C,MAAM,EAAE,QAAQ;AAAA,cACd,WAAW;AAAA,cACX,MAAM,GAAG,sBAAsB,MAAM;AAAA,YAC/C,CAAS;AAAA,UACT,CAAO,EACE,MAAM,OAAO,KAAK,EAClB,UAAU,GAAG,OAAO,KAAK,sBAAsB,MAAM,MAAM,EAC3D,GAAG,SAAS,MAAM;AACjB,mBAAO,MAAM,QAAQ,CAAC,UAAU,SAAS,GAAG,EAAE;AAC9C,gCAAoB,OAAO;AAAA,UACrC,CAAS;AAEH,0BAAgB,MAAM,KAAK,MAAM;AACjC,0BAAgB,MAAM,OAAO,IAAI;QAClC;AAAA,MACL,CAAG;AAAA,IACH;AAEA,aAAS,oBAAoB,SAAS;AACpC;AACA,YAAM,wBAAwB,aAAa,MAAM;AAAA,QAC/C,CAAC,gBAAgB,YAAY,QAAQ,YAAY;AAAA,MACrD;AAEE,YAAM,IAAI,OAAO;AACjB,4BAAsB,QAAQ,CAAC,gBAAgB;AAC7C,cAAM,WAAW,WAAW,YAAY,QAAQ,QAAQ;AACxD,cAAM,YAAY,WAAW,YAAY,QAAQ,SAAS;AAE1D,YAAI,YAAY,WAAW;AACzB,gBAAM,SAAS,EAAE,OAAO,CAAC,UAAU,SAAS,CAAC,EAC1C,MAAM,OAAO,KAAK,EAClB;AAAA,YACC,MAAM,YAAY,IAAI,WAAW,YAAY,QAAQ,MAAM;AAAA,UACrE;AAEM,0BAAgB,MAAM,OAAO,EAAE,KAAK,MAAM;AAAA,QAC3C;AAAA,MACL,CAAG;AAAA,IACH;AAEA,aAAS,sBAAsB;AAC7B,sBAAgB,MAAM,QAAQ,CAAC,WAAW,OAAO,MAAM,YAAY,MAAM,CAAC;AAAA,IAC5E;;;;;;;;;;;;;;;;"}